# Map Builder Agent - 산출물 정의

> 산출물의 구성, 역할, 관계 정의

---

## 산출물 구성

```
mapbuild/outputs/
├── map_spec.json      ← 메인: 빌드 데이터
├── map_design.md      ← 보조: 컨텍스트/설명
└── images/
    ├── floor_plan.png     ← 평면도 (필수)
    ├── front_view.png     ← 정면도 (다층 시)
    ├── side_view.png      ← 측면도 (다층 시)
    └── perspective.png    ← 3D 투시도 (선택)
```

---

## 1. JSON - 빌드 데이터 (메인)

### 역할
```
소비자: AI (분해 에이전트 → MCP 실행)
목적: 기계가 파싱해서 정확히 빌드할 수 있는 구조화 데이터
```

### 포함 내용

```
map_spec.json
├── meta
│   ├── name: 맵 이름
│   ├── version: 명세 버전
│   └── created: 생성 일시
│
├── coordinate_system
│   ├── origin: 원점 위치 정의
│   ├── unit: 1유닛 = ?m
│   └── up_axis: Y
│
├── scale
│   ├── grid_size: 그리드 단위 (예: 0.5m)
│   ├── wall_thickness: 벽 두께 (예: 0.2m)
│   ├── ceiling_height: 기본 천장 높이 (예: 3m)
│   └── door_size: 기본 문 크기 (예: 1.5m x 2.2m)
│
├── floors[]  ← 층 목록 (다층 지원)
│   ├── floor_id
│   ├── floor_level: 층 번호 (0 = 1층)
│   ├── base_height: 이 층의 바닥 Y 좌표
│   └── rooms[]: 이 층의 방 목록
│
├── rooms[]
│   ├── room_id
│   ├── name
│   ├── floor_id: 소속 층
│   ├── position: [x, y, z] 중심점
│   ├── size: [width, height, depth]
│   ├── walls: { north, east, south, west }
│   └── openings[]: 개구부 목록
│
├── walls[]
│   ├── wall_id
│   ├── room_id: 소속 방
│   ├── direction: north/east/south/west
│   ├── exists: true/false
│   ├── start_point: [x, y, z]
│   ├── end_point: [x, y, z]
│   ├── height
│   ├── thickness
│   └── openings[]: 이 벽의 개구부 ID 목록
│
├── openings[]
│   ├── opening_id
│   ├── wall_id: 소속 벽
│   ├── type: door/window/archway
│   ├── position_on_wall: 0.0~1.0 (상대 위치)
│   ├── size: [width, height]
│   └── bottom_offset: 바닥에서 높이
│
└── connections[]
    ├── connection_id
    ├── room_a: 방 ID
    ├── room_b: 방 ID
    ├── type: door/archway/stairs
    └── opening_id: 연결 개구부 ID
```

---

## 2. Markdown - 설계 문서 (보조)

### 역할
```
소비자: AI (컨텍스트 이해), 사용자 (검토/수정)
목적: JSON만으로 이해하기 어려운 의도, 맥락, 원칙 설명
```

### 포함 내용

```
map_design.md
├── 맵 개요
│   ├── 컨셉 설명
│   ├── 용도/목적
│   └── 게임 컨텍스트 (어떤 게임에서 사용)
│
├── 설계 원칙
│   ├── 스케일 기준 (1유닛 = 1m 등)
│   ├── 메트릭 기준 (문 폭, 복도 폭 등)
│   └── 특수 규칙 (있다면)
│
├── 구조 설명
│   ├── 층별 개요
│   ├── 주요 공간 설명
│   └── 동선/연결 관계
│
├── 빌드 노트
│   ├── 우선순위 (어디부터 만들지)
│   ├── 주의사항
│   └── 특수 처리 필요한 부분
│
└── 변경 이력
    └── 수정 내역 (있다면)
```

---

## 3. Image - 시각 자료 (보조)

### 역할
```
소비자: AI (공간 관계 이해), 사용자 (시각적 확인)
목적: JSON 수치만으로 파악 어려운 공간 배치를 시각화
```

### 유형별 용도

| 이미지 | 필수 여부 | 용도 |
|--------|----------|------|
| 평면도 (Top) | **필수** | 방 배치, 연결 관계, XZ 좌표 |
| 정면도 (Front) | 다층 시 필수 | 층 구조, Y 좌표 |
| 측면도 (Side) | 다층 시 필수 | 층 구조, 깊이 관계 |
| 3D 투시도 | 선택 | 전체 느낌, 공간감 |

### 이미지 요구사항

```
공통:
├── 치수 표기 (미터 단위)
├── 방 이름/ID 라벨
├── 그리드 오버레이 (선택)
└── 축 방향 표시 (N/E/S/W 또는 X/Y/Z)

평면도:
├── 벽 실선
├── 문 표시 (열림 방향)
├── 창문 표시 (있다면)
└── 연결 관계 명확

정면도/측면도:
├── 층 구분선
├── 층별 높이 표기
└── 계단/경사로 표시 (있다면)
```

---

## 산출물 간 관계

```
┌─────────────────────────────────────────────┐
│              산출물 생성 순서                 │
├─────────────────────────────────────────────┤
│                                             │
│  유저 입력 (러프 이미지 / 설명)              │
│         │                                   │
│         ▼                                   │
│  ┌─────────────────────────────────┐        │
│  │  1. MD 작성 (작업 문서)          │        │
│  │     - AI가 초안 작성             │        │
│  │     - 유저와 대화하며 수정        │        │
│  │     - ASCII 다이어그램 포함       │        │
│  └──────────────┬──────────────────┘        │
│                 │ 유저 승인                  │
│                 ▼                           │
│  ┌─────────────────────────────────┐        │
│  │  2. Image 생성 (시각적 확인)     │        │
│  │     - 이미지 생성 AI API 사용    │        │
│  │     - 유저 피드백 → MD + Image 수정│      │
│  └──────────────┬──────────────────┘        │
│                 │ 유저 승인                  │
│                 ▼                           │
│  ┌─────────────────────────────────┐        │
│  │  3. JSON 생성 (최종 빌드 데이터)  │        │
│  │     - MD + Image 기반 정밀 수치화 │        │
│  │     - 검증 후 확정               │        │
│  └──────────────┬──────────────────┘        │
│                 │                           │
│                 ▼                           │
│            빌드 (MCP)                       │
│                                             │
├─────────────────────────────────────────────┤
│  핵심 원칙:                                 │
│  - MD가 대화/합의의 중심                    │
│  - Image는 시각적 검증용                    │
│  - JSON은 마지막에 생성 (확정 후)           │
│  - 유저가 만족할 때까지 반복                │
└─────────────────────────────────────────────┘
```

---

## 입력 이미지 vs 산출물 이미지

| 구분 | 입력 이미지 | 산출물 이미지 |
|------|------------|--------------|
| 제공자 | 사용자 | AI |
| 정확도 | 컨셉, 러프 | 정밀, 치수 포함 |
| 용도 | 의도 전달 | 빌드 검증 |
| 필수 여부 | 선택 | 필수 |

```
사용자 컨셉 이미지     AI가 생성한 설계도
   (러프)         →      (정밀)

┌─────────┐          ┌─────────────────┐
│ ┌─┐ ┌─┐ │          │ Room_01  Room_02│
│ └─┘ └─┘ │    →     │  8x6m    8x6m   │
│   ───   │          │ ════════════════│
└─────────┘          │  Hallway 3x16m  │
                     └─────────────────┘
```

---

## 산출물 생성 흐름

```
입력 단계:
├── 유저 이미지 제공 → AI 해석 → MD 작성
└── 유저 설명 제공 → AI 정리 → MD 작성

대화/합의 단계 (MD 중심):
├── AI가 MD 초안 작성 (ASCII 다이어그램 포함)
├── 유저 검토 → 수정 요청
├── AI가 MD 수정
├── 반복...
└── 유저 승인

Image 생성 단계:
├── 이미지 생성 AI API 호출
├── 유저 검토 → 수정 요청 시 MD + Image 수정
└── 유저 승인

JSON 생성 단계:
├── MD + Image 기반 정밀 수치화
├── 검증 규칙 통과 확인
└── 빌드 준비 완료

빌드 단계:
└── MCP 실행 → [00-overview.md#MCP 빌드 단계](00-overview.md)
```

---

## 다음 단계

- [x] JSON 스키마 상세 정의 → [02-json-schema.md](02-json-schema.md)
- [x] 검증 규칙 정의 → [03-validation-rules.md](03-validation-rules.md)
- [x] MD 명세 작성 → [04-md-spec.md](04-md-spec.md)
- [x] Image 생성 명세 → [05-image-spec.md](05-image-spec.md)
- [x] MCP 빌드 단계 → [00-overview.md](00-overview.md)
- [ ] 스케일 기준 표준화 (게임별 메트릭)
- [ ] 예제 맵 생성 및 검증
