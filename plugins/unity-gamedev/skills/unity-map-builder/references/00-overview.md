# Map Builder Agent - Overview

> Unity ProBuilder 기반 맵 자동 생성 에이전트 시스템

---

## 목표

이미지 또는 자연어 입력을 받아 Unity에서 ProBuilder로 맵을 자동 생성하는 범용 에이전트

**타겟 사용자**: 게임 개발자 누구나

---

## 핵심 원칙

1. **입력이 뭐든 산출물은 동일** - 이미지든 대화든 같은 형태의 산출물 생성
2. **AI가 주 소비자** - 산출물은 AI가 파싱/이해할 수 있도록 설계
3. **정밀한 산출물** - 컨셉 → 빌드 가능한 정밀 설계로 변환
4. **멀티에이전트** - 산출물 생성은 여러 에이전트가 협력

---

## 전체 워크플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         MAP BUILDER AGENT                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [입력]        [대화/합의]        [산출물 생성]      [분해]    [빌드]   │
│                                   (순차적)                              │
│                                                                         │
│  이미지 ──┐                                                             │
│           ├→ 대화 ─→ MD 작성 ─→ Image 생성 ─→ JSON 생성 ─→ MCP 실행   │
│  대화 ───┘          (반복)      (반복)        (확정)                   │
│                        │           │             │                      │
│                    유저승인     유저승인       검증통과                 │
│                                                                         │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │ 산출물 생성 순서                                                │    │
│  │                                                                │    │
│  │  1️⃣ MD 작성      → 유저와 대화하며 반복 수정                    │    │
│  │       ↓ 승인                                                   │    │
│  │  2️⃣ Image 생성   → 이미지 생성 AI API로 정밀 도면               │    │
│  │       ↓ 승인                                                   │    │
│  │  3️⃣ JSON 생성    → 빌드용 정밀 데이터 (마지막)                  │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 입력 방식: 하이브리드

### 시작 분기

```
"맵 이미지나 참조 자료가 있으신가요?"
    │
    ├── Yes → 이미지 기반 대화
    │         - 이미지 분석
    │         - 세부사항 질문/확정
    │
    └── No  → 처음부터 대화
              - 요구사항 수집
              - 구조 제안/확정
```

### 공통 결과

어느 경로든 **동일한 산출물**로 수렴

---

## 입력 유형별 특징

| 입력 | 특징 | AI가 해야 할 일 |
|------|------|----------------|
| 컨셉 이미지 | 러프, 대략적, 비정확 | 해석 → 정밀화 → 치수 확정 |
| 자연어 | 추상적 설명 | 구조화 → 구체화 → 치수 확정 |

**핵심**: 둘 다 "대충"에서 "정확한 빌드 명세"로 변환하는 과정

---

## 대화/합의 단계

```
목적: 모호함 제거, 빌드 가능한 수준으로 확정
매체: MD 파일 (작업 문서)

확정해야 할 것:
├── 맵 전체 크기
├── 방 개수와 용도
├── 방별 크기
├── 연결 관계 (문, 통로)
├── 층수 (단층/다층)
└── 스케일 기준

대화 흐름:
├── AI가 MD 초안 작성 (ASCII 다이어그램 포함)
├── 유저 검토 → 수정 요청
├── AI가 MD 수정
├── 반복...
└── 유저 승인 → Image 생성 단계로
```

---

## MCP 빌드 단계

JSON 생성 후 Unity ProBuilder로 빌드하는 단계:

```
입력: JSON (map_spec.json)
출력: Unity 씬에 ProBuilder로 구현된 맵

┌───────────────────────────────────────────────────────┐
│  빌드 순서 (방별)                                      │
├───────────────────────────────────────────────────────┤
│  1. 바닥 생성 (앵커)                                   │
│     └── probuilder-create-shape (Plane)               │
│                                                       │
│  2. 외벽 생성 (바닥 기준)                              │
│     └── probuilder-create-shape (Cube) 또는 extrude   │
│                                                       │
│  3. 개구부 생성 (벽에 구멍)                            │
│     ├── probuilder-delete-faces                       │
│     └── 또는 probuilder-create-shape (Door)           │
│                                                       │
│  4. 천장 생성 (마지막)                                 │
│     └── probuilder-create-shape (Plane), Y=천장높이   │
└───────────────────────────────────────────────────────┘
```

### 결과 검증

| 검증 유형 | 확인 항목 |
|----------|----------|
| 구조적 | 모든 방 생성, 각 방 구성요소 완료 |
| 기하학적 | 방 간 갭 < 0.01m, 겹침 없음, 개구부 연결 |
| 시각적 | 뷰포트 스크린샷 vs Image 산출물 비교 |

---

## 다음 문서

### 산출물 명세
- [01-outputs.md](01-outputs.md) - 산출물 상세 정의
- [02-json-schema.md](02-json-schema.md) - JSON 스키마
- [03-validation-rules.md](03-validation-rules.md) - 검증 규칙
- [04-md-spec.md](04-md-spec.md) - MD 명세 (작업 문서)
- [05-image-spec.md](05-image-spec.md) - 이미지 명세
