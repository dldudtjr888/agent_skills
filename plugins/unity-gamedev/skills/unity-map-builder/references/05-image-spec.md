# Map Builder Agent - Image 명세

> MD 승인 후 이미지 생성 AI로 정밀 시각화

---

## 역할

```
Image는 "정밀 시각화" 산출물

핵심 역할:
├── MD 승인 후 생성 (2단계)
├── 이미지 생성 AI API로 정밀 도면 생성
├── 유저의 시각적 확인/승인용
└── JSON 생성 전 최종 검토

소비자:
├── AI: 빌드 결과 비교 타겟, JSON 생성 참조
└── 유저: 시각적 검토, 직관적 확인, 승인

생성 방법:
├── 이미지 생성 AI API 사용 (DALL-E, Midjourney 등)
├── MD의 ASCII 다이어그램 + 치수 정보 기반
└── 정형화된 건축 도면 스타일
```

---

## 세 산출물의 관계

```
        ┌─────────────────────────────────┐
        │      합의된 내용 (개념적)         │
        │  "교실 3개 + 복도, 문으로 연결"   │
        └─────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        ↓             ↓             ↓
    ┌───────┐    ┌───────┐    ┌───────┐
    │ JSON  │ ←→ │  MD   │ ←→ │ Image │
    │정밀수치│    │텍스트 │    │시각화 │
    └───────┘    └───────┘    └───────┘
        │             │             │
        └─────────────┴─────────────┘
                      │
              모두 동일한 내용
              서로 일치해야 함
```

---

## 생성 흐름

### 정방향: MD → Image 생성

MD 승인 후 이미지 생성 AI API로 정밀 도면 생성:

```
┌────────────────────────────────────────────────────────┐
│ MD 승인 완료                                            │
│                                                        │
│ ## 공간 목록                                            │
│ - Classroom A: 8x6m                                    │
│ - Classroom B: 8x6m                                    │
│ - Hallway: 16x3m                                       │
│                                                        │
│ ## ASCII 다이어그램                                     │
│ ┌───────────┐   ┌───────────┐                          │
│ │Classroom A│   │Classroom B│                          │
│ └─────◠─────┘   └─────◠─────┘                          │
│       └─────┬─────┘                                    │
│         ┌───┴───┐                                      │
│         │Hallway│                                      │
│         └───────┘                                      │
└────────────────────────────────────────────────────────┘
                    │
                    ▼
         이미지 생성 AI API 호출
         (프롬프트: MD 내용 + 도면 스타일 지시)
                    │
                    ▼
┌─────────────────────────────────────────┐
│  [생성된 정밀 평면도 이미지]              │
│                                         │
│  - 정확한 치수 표기                       │
│  - 방 이름 라벨                          │
│  - 문/창문 심볼                          │
│  - 스케일 바                             │
│  - 축 방향 표시                          │
└─────────────────────────────────────────┘
                    │
                    ▼
         유저 검토: "좋아요!" 또는 "문 위치 수정해주세요"
```

### 역방향: 유저 Image → MD

유저가 러프 이미지를 제공하면 MD로 변환:

```
유저가 손그림/스크린샷 업로드
         │
         ▼
AI가 이미지 분석:
├── "사각형 3개가 보입니다"
├── "가운데가 복도 같습니다"
└── "양쪽에 문 표시가 있습니다"
         │
         ▼
대화로 명확화:
├── "교실 크기는 어느 정도인가요?"
└── "복도 폭은 3m 정도 맞나요?"
         │
         ▼
MD 작성 → 유저 확인/수정 → MD 승인
         │
         ▼
정밀 Image 생성 (이미지 생성 AI API)
```

---

## 이미지 유형

| 유형 | 파일명 | 필수 | 용도 |
|------|--------|------|------|
| 평면도 | `floor_plan.png` | **항상** | XZ 평면, 방 배치 |
| 정면도 | `front_view.png` | 다층 시 | XY 평면, 층 구조 |
| 측면도 | `side_view.png` | 다층 시 | ZY 평면, 깊이 |

---

## 평면도 표현 규칙

### 필수 요소

| 요소 | 표현 | 용도 |
|------|------|------|
| 방 외곽 | 실선 사각형/다각형 | 공간 경계 |
| 방 이름 | 텍스트 라벨 | 식별 |
| 방 크기 | `8x6m` 형식 | 치수 확인 |
| 문 | 호(◠) 또는 갭 | 연결 표시 |
| 창문 | 이중선(═) | 개구부 표시 |
| 축 방향 | N↑ 또는 +Z↑ | 방향 기준 |
| 스케일 바 | `████ = 5m` | 비례 확인 |

### 시각 예시

```
                    N
                    ↑
    ┌───────────────────────────────────┐
    │                                   │
    │   ┌───────────┐   ┌───────────┐  │
    │   │           │   │           │  │
    │   │Classroom A│   │Classroom B│  │
    │   │  8x6m     │   │  8x6m     │  │
    │   │           │   │           │  │
    │   └─────◠─────┘   └─────◠─────┘  │
    │         │               │        │
    │   ┌─────┴───────────────┴─────┐  │
    │   │                           │  │
    │   │        Hallway            │  │
    │   │        16x3m              │  │
    │   │                           │  │
    │   └───────────────────────────┘  │
    │                                   │
    │   Scale: ████ = 5m               │
    └───────────────────────────────────┘
```

### 개구부 심볼

```
문 (Door):        ◠ (호) 또는 ─┐ (열림 방향)
창문 (Window):    ═══ (이중선)
아치웨이:         ┄┄┄ (점선 갭)
```

---

## 정면도 표현 규칙 (다층)

### 필수 요소

| 요소 | 표현 |
|------|------|
| 층 바닥선 | 실선 |
| 층 라벨 | `1F`, `2F`, `B1` |
| 높이 치수 | `3m` |
| 계단 | 대각선 |

### 시각 예시

```
    ┌─────────────────────────────────┐ ← 6m
    │              2F                 │
    │         (ceiling: 3m)           │
    │                     ╱───────────┤ ← 계단
    ├─ ─ ─ ─ ─ ─ ─ ─ ─ ─╱─ ─ ─ ─ ─ ─┤ ← 3m
    │              1F   ╱             │
    │         (ceiling: 3m)           │
    │                                 │
    └─────────────────────────────────┘ ← 0m (지면)
```

---

## 색상 규칙

| 요소 | 색상 | Hex | 이유 |
|------|------|-----|------|
| 벽 | 검정 | #000000 | 명확한 경계 |
| 문 | 파랑 | #0066CC | 구분 용이 |
| 창문 | 하늘색 | #66CCFF | 문과 구분 |
| 계단 | 주황 | #FF6600 | 층간 연결 강조 |
| 라벨 | 회색 | #333333 | 가독성 |
| 치수선 | 빨강 | #CC0000 | 눈에 띔 |
| 방 내부 | 흰색 | #FFFFFF | 깔끔함 |

---

## 일치성 검증

### Image ↔ JSON 체크리스트

| 검증 항목 | 방법 |
|----------|------|
| 방 개수 | 이미지 박스 수 == rooms.length |
| 방 크기 비율 | 이미지 비례 == size 비율 |
| 연결 위치 | 문 심볼 위치 == connection 정보 |
| 층 수 | 정면도 층 == floors.length |

### Image ↔ MD 체크리스트

| 검증 항목 | 방법 |
|----------|------|
| 방 이름 | 이미지 라벨 == MD 공간 목록 |
| 치수 표기 | 이미지 크기 == MD 크기 |
| 연결 다이어그램 | 이미지 배치 == MD ASCII |

### 빌드 후 검증

```
1. Unity 빌드 완료
2. 동일 시점에서 스크린샷 캡처
3. 생성된 Image와 비교
4. 차이점 리포트:
   - 방 위치 오차
   - 크기 오차
   - 누락된 연결
```

---

## 이미지 생성 방법

### 이미지 생성 AI API 사용

```
사용 API: DALL-E, Midjourney, Stable Diffusion 등

프롬프트 구성:
├── MD의 공간 정보 (방 이름, 크기, 배치)
├── 도면 스타일 지시 (건축 평면도, 흰 배경, 검은 선)
├── 필수 요소 포함 지시 (치수, 라벨, 스케일 바)
└── 해상도 지정 (1920x1080 권장)

예시 프롬프트:
"Architectural floor plan, white background, black lines.
Two rooms labeled 'Classroom A' (8x6m) and 'Classroom B' (8x6m)
connected to 'Hallway' (16x3m) via doors.
Include dimension labels, scale bar (1 unit = 5m),
north arrow pointing up."
```

### LLM이 직접 생성하지 않음

```
❌ 잘못된 방식:
LLM이 직접 PNG/JPG 파일 생성 시도

✅ 올바른 방식:
1. LLM이 MD 기반 프롬프트 작성
2. 이미지 생성 AI API 호출
3. 생성된 이미지 유저에게 표시
4. 피드백 반영 → 프롬프트 수정 → 재생성
```

### AI가 Image 해석 (역방향)

```
입력: 유저가 제공한 러프 이미지
처리:
1. Vision AI로 이미지 분석
2. 사각형/도형 인식
3. 텍스트/라벨 읽기
4. 연결 관계 추론
5. 대화로 불명확한 부분 확인
출력: MD 작성 → 유저 확인
```

---

## 출력 사양

### 해상도

```
스케일: 1m = 50px (권장)
최소: 800 x 600
권장: 1920 x 1080
```

### 파일 형식

```
형식: PNG
배경: 흰색 또는 투명
```

---

## 입력 이미지 vs 출력 이미지

| 구분 | 입력 (유저 제공) | 출력 (AI 생성) |
|------|-----------------|----------------|
| 정확도 | 러프, 대략적 | 정밀, 치수 포함 |
| 용도 | 의도 전달 | 빌드 타겟 |
| 형태 | 손그림, 스크린샷 | 정형화된 도면 |

```
유저 입력 이미지          AI 생성 이미지
   (러프)           →       (정밀)

┌─────────┐              ┌─────────────────┐
│ ┌─┐ ┌─┐ │              │ Classroom A  8x6│
│ └─┘ └─┘ │      →       │ ════════════════│
│   ───   │              │    Hallway 16x3 │
└─────────┘              └─────────────────┘
```

---

## 참고 문서

- [00-overview.md](00-overview.md) - 전체 개요
- [01-outputs.md](01-outputs.md) - 산출물 정의
- [02-json-schema.md](02-json-schema.md) - JSON 스키마
- [03-validation-rules.md](03-validation-rules.md) - 검증 규칙
- [04-md-spec.md](04-md-spec.md) - MD 명세
