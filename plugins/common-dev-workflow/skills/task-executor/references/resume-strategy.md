# Resume Strategy

중단된 태스크 실행을 재개하는 전략.

## 상태 기반 재개 로직

### 체크박스 상태별 처리

| 상태 | 마커 | Resume 시 동작 |
|------|------|---------------|
| 대기 중 | `[ ]` | 정상 실행 |
| 완료 | `[x]` | 스킵 |
| 진행 중 | `[~]` | 재시작 (처음부터) |
| 실패 | `[!]` | 재시도 여부 확인 |
| 스킵됨 | `[-]` | 재평가 (의존성 확인) |

## 재개 워크플로우

```
1. 태스크 파일 파싱
   ↓
2. 각 태스크 상태 분류
   ├── completed: [x] 태스크 목록
   ├── in_progress: [~] 태스크 목록
   ├── failed: [!] 태스크 목록
   ├── skipped: [-] 태스크 목록
   └── pending: [ ] 태스크 목록
   ↓
3. 재시작 지점 결정
   ├── [~] 있으면: 해당 Wave부터
   ├── [!] 있으면: 사용자 확인 후 결정
   └── 없으면: 첫 미완료 Wave부터
   ↓
4. 의존성 재평가
   ├── [x] 선행 → 후속 실행 가능
   ├── [!] 선행 → 후속 스킵 또는 재시도
   └── [-] 선행 → 의존성 변경 시 재평가
   ↓
5. 실행 재개
```

## 진행 중 `[~]` 태스크 처리

진행 중이던 태스크는 **처음부터 재시작**:

```markdown
# 중단 시점
- [~] **T-003**: API 구현
  - 작업:
    - [x] 엔드포인트 정의
    - [x] 핸들러 구현
    - [ ] 에러 처리 ← 여기서 중단

# Resume 시
- [ ] **T-003**: API 구현  ← 체크박스 리셋
  - 작업:
    - [ ] 엔드포인트 정의  ← 모두 리셋
    - [ ] 핸들러 구현
    - [ ] 에러 처리
```

**이유**: 서브에이전트가 새로 시작하므로 중간 상태 보장 불가

## 실패 `[!]` 태스크 처리

### 사용자 확인 프롬프트

```
⚠️ 실패한 태스크 발견:

T-003: API 구현
  - 에러: npm test 실패
  - 시도: 2/2회

선택:
[1] 재시도 - 다시 실행 (시도 횟수 리셋)
[2] 스킵 - 건너뛰기 (의존 태스크도 스킵)
[3] 수정 후 재시도 - 직접 수정 후 계속
```

### 재시도 시

```markdown
# 재시도 선택
- [ ] **T-003**: API 구현  ← 상태 리셋
  <!-- 이전 에러: npm test 실패 -->
```

## 스킵됨 `[-]` 태스크 재평가

### 선행 태스크가 성공한 경우

```
# 상황
T-003 [!] 실패 → T-006 [-] 스킵됨

# T-003 재시도 후 성공
T-003 [x] 성공

# T-006 재평가
T-006 의존성(T-003) 충족 → [ ] 대기 중으로 변경
```

### 재평가 알고리즘

```python
def reevaluate_skipped(task):
    dependencies = parse_blocked_by(task)

    for dep in dependencies:
        if dep.status == 'failed':
            return 'skipped'  # 여전히 스킵
        if dep.status != 'completed':
            return 'pending'  # 의존성 대기

    return 'pending'  # 실행 가능
```

## Wave 재개 전략

### 부분 완료 Wave

```
Wave 2:
  T-003 [x] 완료
  T-004 [x] 완료
  T-005 [!] 실패
  T-006 [-] 스킵

Resume 시:
  → Wave 2의 T-005, T-006만 재처리
  → T-003, T-004는 스킵
```

### 완전 완료 Wave

```
Wave 1 [모두 x] → 완전 스킵
Wave 2 [일부 x] → 미완료만 실행
```

## 서브스텝 상태 복원

### 서브스텝 상태 무시

```markdown
# 중단 시점 (서브스텝 일부 완료)
- [~] **T-003**: API 구현
  - 작업:
    - [x] 엔드포인트 정의
    - [x] 핸들러 구현
    - [ ] 에러 처리

# Resume 시 (전체 리셋)
- [ ] **T-003**: API 구현
  - 작업:
    - [ ] 엔드포인트 정의
    - [ ] 핸들러 구현
    - [ ] 에러 처리
```

**이유**: 서브에이전트가 중간 상태를 이해할 수 없음

## 의존성 그래프 재구성

Resume 시 의존성 그래프 재구성:

```python
def rebuild_dependency_graph(tasks):
    graph = {}

    for task in tasks:
        if task.status == 'completed':
            graph[task.id] = 'satisfied'
        elif task.status == 'failed':
            graph[task.id] = 'failed'
        else:
            deps = parse_blocked_by(task)
            graph[task.id] = check_dependencies(deps, graph)

    return graph
```

## 안전장치

### 무한 재시도 방지

```
재시도 횟수 추적 (태스크 아래 주석으로):

- [!] **T-003**: API 구현
  <!-- 재시도: 3/2 (한도 초과) -->

한도 초과 시:
  → 자동 스킵으로 전환
  → 사용자에게 수동 처리 권고
```

### 순환 스킵 방지

```
모든 남은 태스크가 스킵 상태면:
  → 실행 중단
  → 의존성 문제 보고
```
